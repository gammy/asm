<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>~/code/asm/DOS/fap.asm.html</title>
<meta name="Generator" content="Vim/7.1">
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
</head>
<body bgcolor="#202020" text="#d0d0d0"><font face="monospace">
;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;by gammy</font></span><br>
;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;nasm -fbin -o lol.com lol.asm</font></span><br>
;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;a work in progress :D</font></span><br>
;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;TODO:</font></span><br>
;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;- randomize</font></span><br>
;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;- star structure + star init</font></span><br>
;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;- finish vblank</font></span><br>
<br>
[<span style="background-color: #202020"><font color="#7ee0ce">bits</font></span>&nbsp;<span style="background-color: #202020"><font color="#87df71">16</font></span>]<br>
<br>
<span style="background-color: #202020"><font color="#7ee0ce">org</font></span>&nbsp;<span style="background-color: #202020"><font color="#87df71">0x100</font></span><br>
<br>
<span style="background-color: #202020"><font color="#7ee0ce">mov</font></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="background-color: #202020"><font color="#7ee0ce">ax</font></span>,&nbsp;&nbsp;&nbsp;&nbsp; <span style="background-color: #202020"><font color="#87df71">0x13</font></span><br>
<span style="background-color: #202020"><font color="#7ee0ce">int</font></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="background-color: #202020"><font color="#87df71">0x10</font></span><br>
<br>
<span style="background-color: #202020"><font color="#7ee0ce">call</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">init_pal</font></span><br>
<br>
<span style="background-color: #202020"><font color="#7ee0ce">main_loop</font></span>:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">call</font></span>&nbsp;&nbsp; <span style="background-color: #202020"><font color="#7ee0ce">draw</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<span style="background-color: #202020"><font color="#d0d0a0">call&nbsp;&nbsp;wait_vblank</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">call</font></span>&nbsp;&nbsp; <span style="background-color: #202020"><font color="#7ee0ce">kb_chk_esc</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">jmp</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">main_loop</font></span><br>
<br>
<span style="background-color: #202020"><font color="#7ee0ce">init_pal</font></span>:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">xor</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">ax</font></span>, <span style="background-color: #202020"><font color="#7ee0ce">ax</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">mov</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">dx</font></span>, <span style="background-color: #202020"><font color="#87df71">0x3c8</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">out</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">dx</font></span>, <span style="background-color: #202020"><font color="#7ee0ce">al</font></span><br>
<span style="background-color: #202020"><font color="#7ee0ce">pal_loop</font></span>:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">mov</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">dx</font></span>, <span style="background-color: #202020"><font color="#87df71">0x3c9</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">mov</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">al</font></span>, <span style="background-color: #202020"><font color="#87df71">0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;Because I want blue.</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">out</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">dx</font></span>, <span style="background-color: #202020"><font color="#7ee0ce">al</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">out</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">dx</font></span>, <span style="background-color: #202020"><font color="#7ee0ce">al</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">mov</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">al</font></span>, <span style="background-color: #202020"><font color="#7ee0ce">ah</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">shr</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">al</font></span>, <span style="background-color: #202020"><font color="#87df71">2</font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;/ 4</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">out</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">dx</font></span>, <span style="background-color: #202020"><font color="#7ee0ce">al</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">inc</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">ah</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">mov</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">al</font></span>, <span style="background-color: #202020"><font color="#7ee0ce">ah</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">cmp</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">ah</font></span>, <span style="background-color: #202020"><font color="#87df71">255</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">jne</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">pal_loop</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">ret</font></span><br>
<br>
<span style="background-color: #202020"><font color="#7ee0ce">draw</font></span>:&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;Obviously just a test so far.</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">xor</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">ax</font></span>, <span style="background-color: #202020"><font color="#7ee0ce">ax</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">xor</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">dx</font></span>, <span style="background-color: #202020"><font color="#7ee0ce">dx</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">push</font></span>&nbsp;&nbsp; <span style="background-color: #202020"><font color="#87df71">160</font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;x</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">push</font></span>&nbsp;&nbsp; <span style="background-color: #202020"><font color="#87df71">100</font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;y</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">push</font></span>&nbsp;&nbsp; <span style="background-color: #202020"><font color="#87df71">254</font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;color</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">call</font></span>&nbsp;&nbsp; <span style="background-color: #202020"><font color="#7ee0ce">plot</font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;fucking draw it!</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">ret</font></span><br>
<br>
<span style="background-color: #202020"><font color="#7ee0ce">wait_vblank</font></span>:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">ret</font></span>&nbsp;;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;FIXME not finished</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">mov</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">dx</font></span>, <span style="background-color: #202020"><font color="#87df71">0x3da</font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;vblank addr</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">in</font></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="background-color: #202020"><font color="#7ee0ce">al</font></span>, <span style="background-color: #202020"><font color="#87df71">8</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">testal</font></span>, <span style="background-color: #202020"><font color="#87df71">8</font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;wait for vblank</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">jnz</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">wait_vblank</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">ret</font></span><br>
<br>
<span style="background-color: #202020"><font color="#7ee0ce">kb_chk_esc</font></span>:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">xor</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">ax</font></span>, <span style="background-color: #202020"><font color="#7ee0ce">ax</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">mov</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">ah</font></span>, <span style="background-color: #202020"><font color="#87df71">1</font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;Get keystroke status</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">int</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#87df71">0x16</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">jz</font></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="background-color: #202020"><font color="#7ee0ce">kb_chk_end</font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;No key</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">mov</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">ah</font></span>, <span style="background-color: #202020"><font color="#87df71">0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;Get key</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">int</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#87df71">0x16</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">cmp</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">al</font></span>, <span style="background-color: #202020"><font color="#87df71">27</font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;Is it esc?</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">jne</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">kb_chk_end</font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;nope</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">call</font></span>&nbsp;&nbsp; <span style="background-color: #202020"><font color="#7ee0ce">exit</font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;yup</font></span><br>
<span style="background-color: #202020"><font color="#7ee0ce">kb_chk_end</font></span>:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">ret</font></span><br>
<br>
<span style="background-color: #202020"><font color="#7ee0ce">plot</font></span>:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;prolog (equiv to enter $n, $0)</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">push</font></span>&nbsp;&nbsp; <span style="background-color: #202020"><font color="#7ee0ce">bp</font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;store bp</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">mov</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">bp</font></span>, <span style="background-color: #202020"><font color="#7ee0ce">sp</font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;Setup vram write</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">mov</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">di</font></span>, <span style="background-color: #202020"><font color="#7ee0ce">_vram</font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;stosb reads es:di, so..</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">mov</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">es</font></span>, <span style="background-color: #202020"><font color="#7ee0ce">di</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">xor</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">di</font></span>, <span style="background-color: #202020"><font color="#7ee0ce">di</font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;Compute offset (i = y; i &lt;&lt;= 8; i += y &lt;&lt; 6; i += x)</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">mov</font></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="background-color: #202020"><font color="#7ee0ce">ax</font></span>, [<span style="background-color: #202020"><font color="#7ee0ce">bp</font></span>&nbsp;+ <span style="background-color: #202020"><font color="#87df71">6</font></span>]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;y</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">mov</font></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="background-color: #202020"><font color="#7ee0ce">dx</font></span>, <span style="background-color: #202020"><font color="#7ee0ce">ax</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">shl</font></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="background-color: #202020"><font color="#7ee0ce">ax</font></span>, <span style="background-color: #202020"><font color="#87df71">8</font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;y &lt;&lt; 8 (256)</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">shl</font></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="background-color: #202020"><font color="#7ee0ce">dx</font></span>, <span style="background-color: #202020"><font color="#87df71">6</font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;y &lt;&lt; 6 (64) (256+64=320)</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">add</font></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="background-color: #202020"><font color="#7ee0ce">ax</font></span>, <span style="background-color: #202020"><font color="#7ee0ce">dx</font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;ax(y &lt;&lt; 8) += dx(y &lt;&lt; 6)</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">add</font></span>&nbsp;&nbsp;&nbsp;&nbsp; <span style="background-color: #202020"><font color="#7ee0ce">ax</font></span>, [<span style="background-color: #202020"><font color="#7ee0ce">bp</font></span>&nbsp;+ <span style="background-color: #202020"><font color="#87df71">8</font></span>]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;+ x</font></span><br>
<br>
;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp;&nbsp; ax, 320&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; width</font></span><br>
;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp;&nbsp; dx, [bp + 6]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; y</font></span><br>
;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mul&nbsp;&nbsp;&nbsp;&nbsp; dx; ax *= dx</font></span><br>
;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; add&nbsp;&nbsp;&nbsp;&nbsp; ax, [bp + 8]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; + x</font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">mov</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">di</font></span>, <span style="background-color: #202020"><font color="#7ee0ce">ax</font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;ready for stosb</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">mov</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">al</font></span>, [<span style="background-color: #202020"><font color="#7ee0ce">bp</font></span>&nbsp;+ <span style="background-color: #202020"><font color="#87df71">4</font></span>]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;color</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">stosb</font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;al -&gt; vram (fucking updated!)</font></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;epilog</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">pop</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">bp</font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;restore bp</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">ret</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#87df71">6</font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;2 bytes per parm, 3 parm = 6 bytes</font></span><br>
<br>
<span style="background-color: #202020"><font color="#7ee0ce">exit</font></span>:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;Textmode</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">mov</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">ax</font></span>, <span style="background-color: #202020"><font color="#87df71">0x3</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">int</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#87df71">0x10</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;Terminate</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">mov</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">ah</font></span>, <span style="background-color: #202020"><font color="#87df71">0x4c</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">mov</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">al</font></span>, <span style="background-color: #202020"><font color="#87df71">0</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">int</font></span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#87df71">0x21</font></span><br>
<br>
;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;<a href="http://eradicus.blogsome.com/2006/09/06/random-number-generator-in-16-bit-dos-assembly/">http://eradicus.blogsome.com/2006/09/06/random-number-generator-in-16-bit-dos-assembly/</a> (with minor changes)</font></span><br>
;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;8-bit.</font></span><br>
;<span style="background-color: #202020"><font color="#d0d0a0">randomize:</font></span><br>
;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xor&nbsp;&nbsp;&nbsp;&nbsp; ax, ax</font></span><br>
;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; in&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;al, 40h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; read micro-clock for initial seed</font></span><br>
;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp;&nbsp; ah, al</font></span><br>
;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; in&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;al, 40h</font></span><br>
;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xchg&nbsp;&nbsp;&nbsp;&nbsp;al, ah</font></span><br>
;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; or&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ax, 1</font></span><br>
;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mov&nbsp;&nbsp;&nbsp;&nbsp; rnum, ax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; FIXME</font></span><br>
;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ret</font></span><br>
<br>
<span style="background-color: #202020"><font color="#7ee0ce">_waitmsg</font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">db</font></span>&nbsp;'<span style="background-color: #202020"><font color="#7ee0ce">Hit</font></span>&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">a</font></span>&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">key</font></span>.', <span style="background-color: #202020"><font color="#87df71">10</font></span>, <span style="background-color: #202020"><font color="#87df71">13</font></span>, '$'<br>
<span style="background-color: #202020"><font color="#7ee0ce">_message</font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">db</font></span>&nbsp;&nbsp;'<span style="background-color: #202020"><font color="#7ee0ce">LOL</font></span>!', <span style="background-color: #202020"><font color="#87df71">10</font></span>, <span style="background-color: #202020"><font color="#87df71">13</font></span>, '$'<br>
<span style="background-color: #202020"><font color="#7ee0ce">_vram</font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="background-color: #202020"><font color="#7ee0ce">equ</font></span>&nbsp;<span style="background-color: #202020"><font color="#87df71">0xa000</font></span><br>
<br>
<span style="background-color: #202020"><font color="#7ee0ce">_star_count</font></span>&nbsp;<span style="background-color: #202020"><font color="#7ee0ce">equ</font></span>&nbsp;<span style="background-color: #202020"><font color="#87df71">256</font></span><br>
<br>
;<span style="background-color: #202020"><font color="#d0d0a0">struc stars</font></span><br>
;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;&nbsp;&nbsp;&nbsp;.x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resw&nbsp;&nbsp;&nbsp;&nbsp;_star_count</font></span><br>
;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;&nbsp;&nbsp;&nbsp;.y&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resw&nbsp;&nbsp;&nbsp;&nbsp;_star_count</font></span><br>
;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;&nbsp;&nbsp;&nbsp;.xstep&nbsp;&nbsp;resb&nbsp;&nbsp;&nbsp;&nbsp;_star_count</font></span><br>
;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;&nbsp;&nbsp;&nbsp;.ystep&nbsp;&nbsp;resb&nbsp;&nbsp;&nbsp;&nbsp;_star_count</font></span><br>
;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;&nbsp;&nbsp;&nbsp;.color&nbsp;&nbsp;resb&nbsp;&nbsp;&nbsp;&nbsp;_star_count</font></span><br>
;<span style="background-color: #202020"><font color="#d0d0a0">endstruc</font></span><br>
;<br>
;<span style="background-color: #202020"><font color="#d0d0a0">star:</font></span><br>
;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;&nbsp;&nbsp;&nbsp;istruc stars</font></span><br>
;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;&nbsp;.x,&nbsp;&nbsp;&nbsp;&nbsp; dw 1</font></span><br>
;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;&nbsp;.y,&nbsp;&nbsp;&nbsp;&nbsp; dw 1</font></span><br>
;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;&nbsp;.xstep, db 1</font></span><br>
;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;&nbsp;.ystep, db 1</font></span><br>
;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;&nbsp;.color, db 1</font></span><br>
;<span style="background-color: #202020"><font color="#d0d0a0">&nbsp;&nbsp;&nbsp;&nbsp;iend</font></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
<br>
</font></body>
</html>
